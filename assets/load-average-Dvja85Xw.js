import{_ as d}from"./ValaxyMain.vue_vue_type_style_index_0_lang-CBf5hEqz.js";import{a as r,p as k,o as F,c as g,w as i,f as c,r as l,g as s,h as t}from"./app-BZDWLfP1.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-Be0Mb7hY.js";import"./YunCard.vue_vue_type_script_setup_true_lang-Dhwia5MJ.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-Bqy1HhVw.js";import"./index-C7yU5XnD.js";const C=s("p",null,"发现系统变慢时，我们可以通过 top 或 uptime 命令，了解系统负载情况，如下。",-1),u=s("div",{class:"language-shell vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"shell"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"$"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," watch"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -d"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," uptime")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"02:34:03"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," up"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 2"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," days,"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 20:14,"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  1"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," user,"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  load"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," average:"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0.63,"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 0.83,"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 0.88")])])]),s("button",{class:"collapse"})],-1),y=s("p",null,"Watch -d 可以高亮显示变化的值，输出值含义如下。",-1),m=s("div",{class:"language- vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"02:34:03 					   // 当前系统时间")]),t(`
`),s("span",{class:"line"},[s("span",null,"up 2 days, 20:14 			   // 系统运行时间")]),t(`
`),s("span",{class:"line"},[s("span",null,"1 user 						   // 正在登陆用户数")]),t(`
`),s("span",{class:"line"},[s("span",null,"load average: 0.63, 0.83, 0.88 // 过去 1分钟、5分钟、15分钟的平均负载")])])]),s("button",{class:"collapse"})],-1),B=s("p",null,[t("前面 3 个输出值很好理解，重点解释，什么是平均负载。平均负载是指单位时间内，系统处于"),s("strong",null,"可运行状态"),t("和"),s("strong",null,"不可中断状态"),t("的平均进程数。")],-1),v=s("ul",null,[s("li",null,"可运行状态进程：处于运行队列中的进程，使用 ps 命令，看到处于 R （Running 或 Runnable）状态的进程，正在等待 CPU 资源"),s("li",null,"不可中断状态进程：处于等待 I/O 操作完成的进程，例如磁盘读写操作，使用 ps 命令，看到处于 D （Disk Sleep）状态的进程 平均进程数的平均，是一个统计学意义上的平均值，统计方法为 EWMA 加权移动平均，这里不展开介绍。 平均负载的值，最理想的情况是每个 CPU 上都刚好运行了一个进程，例如平均负载为 2。"),s("li",null,"2 个 CPU 的系统上，意味着所有 CPU 都刚好被占用，理想状态"),s("li",null,"4 个 CPU 的系统上，意味着 CPU 有 50% 处于空闲状态"),s("li",null,"1 个 CPU 的系统上，意味着有一半的进程竞争不到 CPU")],-1),b=s("div",{class:"language-shell vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"shell"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"$"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," grep"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 'model name'"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," /proc/cpuinfo"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," |"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," wc"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -l"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," //"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 获取"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," CPU"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," 核数")])])]),s("button",{class:"collapse"})],-1),_=s("p",null,"CPU 使用率和平均负载不能划上等号。例如 I/O 密集型进程，等待 I/O 会导致平均负载很高，但 CPU 使用率不一定很高。 在 ubuntu 上，可以通过 sysstat 监控和分析系统的性能。",-1),E=s("div",{class:"language- vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"$ apt install sysstat")])])]),s("button",{class:"collapse"})],-1),f=s("p",null,"如果是普通用户登录，先切换到 root 用户。",-1),P=s("div",{class:"language- vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"}),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"$ sudo su root")])])]),s("button",{class:"collapse"})],-1),U=s("p",null,"Sysstat 包的 mpstat 和 pidstat 命令，可以用来分析每个 CPU 的性能指标和进程的 CPU、内存、I/O 等性能指标。下面列举几个使用场景。",-1),$=s("ul",null,[s("li",null,"CPU 密集型进程")],-1),D=s("div",{class:"language-shell vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"shell"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# -P ALL 表示监控所有CPU，后面数字5表示间隔5秒后输出一组数据")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"$"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," mpstat"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -P"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ALL"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 5")])])]),s("button",{class:"collapse"})],-1),A=s("div",{class:"language-shell vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"shell"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 间隔5秒后输出一组数据")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"$"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," pidstat"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 5"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"13:37:07"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"      UID"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"       PID"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"    %usr"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," %system"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  %guest"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"   %wait"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"    %CPU"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"   CPU"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  Command")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"13:37:12"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"        0"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"      2962"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  100.00"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    0.00"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    0.00"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    0.00"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"  100.00"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"     1"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"  stress")])])]),s("button",{class:"collapse"})],-1),w=s("ul",null,[s("li",null,"I/O 密集型进程")],-1),I=s("div",{class:"language-shell vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"shell"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 显示所有CPU的指标，并在间隔5秒输出一组数据")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"$"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," mpstat"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -P"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," ALL"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 5"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1")])])]),s("button",{class:"collapse"})],-1),O=s("ul",null,[s("li",null,"大量进程的场景")],-1),L=s("div",{class:"language-shell vp-adaptive-theme"},[s("button",{title:"Copy Code",class:"copy"}),s("span",{class:"lang"},"shell"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"# 间隔5秒后输出一组数据")]),t(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"$"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}}," pidstat"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," -u"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 5"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," 1")])])]),s("button",{class:"collapse"})],-1),T=s("p",null,"小结如下。",-1),R=s("ul",null,[s("li",null,"平均负载一定要结合 CPU 核数来观察。"),s("li",null,"CPU 使用率和平均负载不能划上等号。"),s("li",null,"1、5、15 分钟的值，可以分析出平均负载的变化趋势。"),s("li",null,"平均负载高于 CPU 数量 70% 的时候，就应该分析排查负载高的原因。")],-1),z={__name:"load-average",setup(S,{expose:p}){const e=JSON.parse('{"title":"观察性能指标“平均负载”","description":"","frontmatter":{"title":"观察性能指标“平均负载”","date":"2024-06-12T00:00:00.000Z","updated":"2024-06-13T00:00:00.000Z","categories":"Unix","tags":["平均负载"]},"headers":[],"relativePath":"pages/posts/load-average.md","path":"/home/runner/work/guowei-gong.github.io/guowei-gong.github.io/pages/posts/load-average.md","lastUpdated":1718246058000}'),n=r(),h=e.frontmatter||{};return n.meta.frontmatter=Object.assign(n.meta.frontmatter||{},e.frontmatter||{}),k("pageData",e),k("valaxy:frontmatter",h),globalThis.$frontmatter=h,p({frontmatter:{title:"观察性能指标“平均负载”",date:"2024-06-12T00:00:00.000Z",updated:"2024-06-13T00:00:00.000Z",categories:"Unix",tags:["平均负载"]}}),(a,N)=>{const o=d;return F(),g(o,{frontmatter:c(h)},{"main-content-md":i(()=>[C,u,y,m,B,v,b,_,E,f,P,U,$,D,A,w,I,O,L,T,R]),"main-header":i(()=>[l(a.$slots,"main-header")]),"main-header-after":i(()=>[l(a.$slots,"main-header-after")]),"main-nav":i(()=>[l(a.$slots,"main-nav")]),"main-content":i(()=>[l(a.$slots,"main-content")]),"main-content-after":i(()=>[l(a.$slots,"main-content-after")]),"main-nav-before":i(()=>[l(a.$slots,"main-nav-before")]),"main-nav-after":i(()=>[l(a.$slots,"main-nav-after")]),comment:i(()=>[l(a.$slots,"comment")]),footer:i(()=>[l(a.$slots,"footer")]),aside:i(()=>[l(a.$slots,"aside")]),"aside-custom":i(()=>[l(a.$slots,"aside-custom")]),default:i(()=>[l(a.$slots,"default")]),_:3},8,["frontmatter"])}}};export{z as default};
